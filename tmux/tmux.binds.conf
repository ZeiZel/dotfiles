# ============================================
# TMUX KEY BINDINGS
# ============================================

# Session management
bind s choose-tree -sZ -O name
bind C new-session
bind X confirm-before -p "Kill session #S? (y/n)" kill-session

# ============================================
# PANE SPLITS (with current path)
# ============================================
unbind %
bind | split-window -h -c "#{pane_current_path}"
bind \\ split-window -h -c "#{pane_current_path}"

unbind '"'
bind - split-window -v -c "#{pane_current_path}"
bind _ split-window -v -c "#{pane_current_path}"

# New window with current path
bind c new-window -c "#{pane_current_path}"

# ============================================
# PANE NAVIGATION (vim-style)
# ============================================
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# ============================================
# PANE RESIZING (with repeat)
# ============================================
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Fine-grained resize
bind -r M-h resize-pane -L 1
bind -r M-j resize-pane -D 1
bind -r M-k resize-pane -U 1
bind -r M-l resize-pane -R 1

# Zoom pane
bind -r m resize-pane -Z
bind z resize-pane -Z

# ============================================
# WINDOW NAVIGATION
# ============================================
bind -r C-h previous-window
bind -r C-l next-window

# Direct window selection
bind -r Tab last-window
bind 0 select-window -t :10

# Swap windows
bind -r "<" swap-window -d -t -1
bind -r ">" swap-window -d -t +1

# ============================================
# COPY MODE (vi-style)
# ============================================
set-window-option -g mode-keys vi

bind Enter copy-mode
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi C-v send -X rectangle-toggle
bind -T copy-mode-vi y send -X copy-selection-and-cancel
bind -T copy-mode-vi Escape send -X cancel

# Don't exit copy mode on mouse drag end
unbind -T copy-mode-vi MouseDragEnd1Pane

# ============================================
# CONFIG RELOAD
# ============================================
unbind r
bind r source-file ~/.tmux.conf \; display-message "  Config reloaded!"

# ============================================
# POPUP WINDOWS
# ============================================

# Lazygit popup
bind g display-popup -E -w 90% -h 90% -d "#{pane_current_path}" "lazygit"

# Btop popup
bind b display-popup -E -w 90% -h 90% "btop"

# Yazi file manager popup
bind y display-popup -E -w 90% -h 90% -d "#{pane_current_path}" "yazi"

# FZF file finder popup
bind f display-popup -E -w 80% -h 60% -d "#{pane_current_path}" \
  "fd --type f --hidden --follow --exclude .git | fzf --preview 'bat --color=always {}' | xargs -r $EDITOR"

# Notes popup (quick scratchpad)
bind n display-popup -E -w 80% -h 80% -d "#{pane_current_path}" "$EDITOR ~/notes.md"

# ============================================
# LAYOUTS
# ============================================

# Preset layouts
bind M-1 select-layout main-horizontal
bind M-2 select-layout main-vertical
bind M-3 select-layout tiled
bind M-4 select-layout even-horizontal
bind M-5 select-layout even-vertical

# Dev layout: 70/30 split
bind D split-window -v -p 30 -c "#{pane_current_path}" \; select-pane -t 0

# IDE layout: main + two right panes
bind I split-window -h -p 30 -c "#{pane_current_path}" \; \
       split-window -v -p 50 -c "#{pane_current_path}" \; \
       select-pane -t 0

# ============================================
# MISC
# ============================================

# Synchronize panes (type in all panes)
bind S set-window-option synchronize-panes \; \
       display-message "#{?synchronize-panes,  Sync ON,  Sync OFF}"

# Clear screen and history
bind C-k send-keys C-l \; clear-history \; display-message "  Cleared!"

# Toggle status bar
bind t set-option status

# Mark pane
bind M select-pane -m
bind m select-pane -M
